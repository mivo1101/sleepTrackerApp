<%- include('../components/header') %>
  <link rel="stylesheet" href="/css/dashboard.css">

  <main class="dashboard-page">
    <div class="dash-shell">

      <section class="dash-hero">
        <p class="dash-sub">
          Good Morning, <b>
            <%= (typeof user !=='undefined' && user.name) ? user.name : 'User' %>
          </b>
        </p>
      </section>

      <section class="row scrollspy" id="log-section">
        <div class="col s12 l6 dash-col">
          <div class="dash-card">
            <div class="card-head">
              <h3>Log Last Night's Sleep</h3>
            </div>
            <div class="card-body">
              <div class="row date-row">
                <div class="col s4">
                  <p>Date</p>
                </div>
                <div class="col s8">
                  <input type="date" id="sleep-date" class="browser-default sleep-date-picker">
                </div>
              </div>

              <div class="center-align">
                <div class="chip-toggle">
                  <button class="chip js-log-toggle" data-view="time">By Time</button>
                  <button class="chip active js-log-toggle" data-view="duration">By Duration</button>
                </div>
              </div>

              <div id="view-duration" class="log-view">
                <div class="row valign-wrapper">
                  <div class="col s4">
                    <p>Duration</p>
                  </div>
                  <div class="col s8 flex-row-align">
                    <select id="input-hours" class="browser-default inline-select">
                      <% for(let h=0; h<=24; h++) { %>
                        <option value="<%= h %>">
                          <%= h.toString().padStart(2, '0' ) %>
                        </option>
                        <% } %>
                    </select>
                    <span class="unit-label">hours</span>

                    <select id="input-minutes" class="browser-default inline-select">
                      <% for(let m=0; m<60; m++) { %>
                        <option value="<%= m %>">
                          <%= m.toString().padStart(2, '0' ) %>
                        </option>
                        <% } %>
                    </select>
                    <span class="unit-label">minutes</span>
                  </div>
                </div>
              </div>

              <div id="view-time" class="log-view" style="display: none;">
                <div class="row valign-wrapper">
                  <div class="col s4">
                    <p>Bed-Wake Time</p>
                  </div>
                  <div class="col s8">
                    <input type="time" class="browser-default inline-select" value="22:00"> to
                    <input type="time" class="browser-default inline-select" value="06:30">
                  </div>
                </div>
              </div>

              <div class="range-container">
                <p>Rate Your Sleep</p>
                <p class="range-field">
                  <input type="range" id="sleep-rate" min="0" max="10" value="8" />
                </p>
              </div>

              <div class="card-footer">
                <button id="btn-view-summary" class="btn black white-text main-action-btn z-depth-0">View
                  Summary</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col s12 l6 dash-col">
          <div class="dash-card preview-card">
            <div class="card-head">
              <h3>Preview Your Sleep Log</h3>
            </div>
            <div class="card-body">
              <p>Total Sleep</p>
              <div class="total-pill center-align">8 hrs 30 mins</div>

              <div class="row info-row">
                <div class="col s5">
                  <p>Time Window</p>
                </div>
                <div class="col s7">
                  <p id="preview-time-window" class="strong">10:00 PM - 06:30 AM</p>
                </div>
              </div>

              <div class="row info-row">
                <div class="col s5">
                  <p>Sleep Quality</p>
                </div>
                <div class="col s7">
                  <p id="preview-quality" class="strong">8/10 - Good</p>
                </div>
              </div>

              <p class="italic-note">Once saved, this cannot be edited.</p>

              <div class="card-footer">
                <button class="btn black white-text main-action-btn z-depth-0">Confirm and Save</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="saved-sleep-display" class="container" style="display: none; margin-bottom: 20px;">
        <div class="card-panel teal white-text">
          <h5>Latest Logged Entry</h5>
          <p id="final-log-text"></p>
        </div>
      </div>

      <div class="card history-card">
        <div class="card-content">
          <span class="card-title">Recent Sleep History</span>
          <table class="striped">
            <thead>
              <tr>
                <th>Date</th>
                <th>Duration</th>
                <th>Quality</th>
              </tr>
            </thead>
            <tbody id="sleep-history-body">
            </tbody>
          </table>
        </div>
      </div>

      <section class="dash-block scrollspy" id="trends-section">
        <div class="dash-card">
          <div class="card-head center-align">
            <h3>Your Sleep Trends</h3>
          </div>

          <div class="center-align">
            <div class="chip-toggle">
              <button class="chip active js-trend-toggle" data-view="weekly">Weekly</button>
              <button class="chip js-trend-toggle" data-view="monthly">Monthly</button>
            </div>
          </div>

          <div id="view-weekly" class="trend-view-container">
            <p class="center-align dash-date-label">Current Week Progress (Dec 22 – Dec 28)</p>
            <div class="graph-wrapper">
              <div class="y-axis"><span>12h</span><span>8h</span><span>4h</span><span>0h</span></div>
              <div class="goal-line"><span>Goal</span></div>
              <div class="bars-container">
                <div class="bar-group">
                  <div class="bar blue" style="height: 35%;"></div><span class="axis-label">Mon</span>
                </div>
                <div class="bar-group">
                  <div class="bar-placeholder">Not Specified</div><span class="axis-label">Tue</span>
                </div>
                <div class="bar-group">
                  <div class="bar blue" style="height: 55%;"></div><span class="axis-label">Wed</span>
                </div>
                <div class="bar-group">
                  <div class="bar blue" style="height: 52%;"></div><span class="axis-label">Thurs</span>
                </div>
                <div class="bar-group">
                  <div class="bar blue active" style="height: 55%;">
                    <div class="bar-tooltip">Fri, Dec 26: 8h 30m</div>
                  </div>
                  <span class="axis-label">Fri</span>
                </div>
                <div class="bar-group">
                  <div class="bar-placeholder">Up coming</div><span class="axis-label">Sat</span>
                </div>
                <div class="bar-group">
                  <div class="bar-placeholder">Up coming</div><span class="axis-label">Sun</span>
                </div>
              </div>
            </div>

            <div class="row trend-details">
              <div class="col s12 m6">
                <p class="strong">Weekly Summary</p>
                <ul class="summary-list">
                  <li><strong>Average Duration:</strong> 7h 45m (Just under goal)</li>
                  <li><strong>Goal Met:</strong> 3 / 4 recorded days</li>
                  <li><strong>Longest Sleep:</strong> Fri, Dec 26 (8h 30m)</li>
                  <li><strong>Shortest Sleep:</strong> Mon, Dec 22 (6h 00m)</li>
                </ul>
              </div>
              <div class="col s12 m6 ai-insight-column">
                <p class="strong">AI Insights <a href="#!" class="js-view-insights blue-text text-lighten-2">View</a>
                </p>
                <div class="ai-content-box" style="display: none;">
                  <ul class="summary-list">
                    <li><strong>Insight:</strong> Strong Recovery Streak</li>
                    <li><strong>Analysis:</strong> After a rough start on Monday (6h), you have bounced back
                      impressively!</li>
                    <li><strong>Recommendation:</strong> Watch out for the weekend. Keep your bedtime within 1 hour of
                      your weekday routine.</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div id="view-monthly" class="trend-view-container" style="display: none;">
            <p class="center-align dash-date-label">Current Month Progress (December 2025)</p>
            <div class="graph-wrapper">
              <div class="y-axis"><span>12h</span><span>8h</span><span>4h</span><span>0h</span></div>
              <div class="goal-line"><span>Goal</span></div>
              <div class="bars-container">
                <div class="bar-group">
                  <div class="bar blue" style="height: 60%;"></div><span class="axis-label">Dec 1-7</span>
                </div>
                <div class="bar-group">
                  <div class="bar blue active" style="height: 67%;">
                    <div class="bar-tooltip">Week 2 Avg: 8h 10m</div>
                  </div><span class="axis-label">Dec 8-14</span>
                </div>
                <div class="bar-group">
                  <div class="bar blue" style="height: 55%;"></div><span class="axis-label">Dec 15-21</span>
                </div>
                <div class="bar-group">
                  <div class="bar blue" style="height: 63%;"></div><span class="axis-label">Dec 22-28</span>
                </div>
                <div class="bar-group">
                  <div class="bar-placeholder">Up coming</div><span class="axis-label">Dec 29-31</span>
                </div>
              </div>
            </div>

            <div class="row trend-details">
              <div class="col s12 m6">
                <p class="strong">Monthly Summary</p>
                <ul class="summary-list">
                  <li><strong>Average Duration:</strong> 7h 35m (Just under goal)</li>
                  <li><strong>Goal Met:</strong> 2 / 4 recorded weeks</li>
                  <li><strong>Best Week:</strong> Week 2, Dec 8-14 (8h 10m)</li>
                  <li><strong>Lowest Week:</strong> Week 3, Dec 15-21 (6h 45m)</li>
                </ul>
              </div>
              <div class="col s12 m6 ai-insight-column">
                <p class="strong">AI Insights <a href="#!" class="js-view-insights blue-text text-lighten-2">View</a>
                </p>
                <div class="ai-content-box" style="display: none;">
                  <ul class="summary-list">
                    <li><strong>Insight:</strong> Getting back on track</li>
                    <li><strong>Analysis:</strong> You started December really well, but things got tough in Week 3
                      (dropping to 6h 45m). The good news is you are already bouncing back this week - great job!</li>
                    <li><strong>Recommendation:</strong> If you know the middle of the month is usually busy, try to get
                      to bed just 30 minutes earlier the week before. It helps you handle the stress much better.</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <h4 class="score-label">Sleep Score:</h4>
        </div>
      </section>

      <section class="dash-block goals" id="goals-section">
        <h2 class="section-title">Your Sleep Goals</h2>
        <div class="dash-grid two-cols">
          <div class="dash-card">
            <div class="card-head">
              <h3>Monthly Goal Settings</h3>
            </div>
            <div class="card-body">
              <p class="muted">December 2025</p>
              <p class="goal-value">8 hrs / night</p>
              <p class="status ok">Active and locked</p>
              <p class="muted">Set on Dec 1 • Cannot change until Jan 1</p>
              <div class="divider"></div>
              <div class="next-goal">
                <p class="muted">Next Month Goal (Jan 2026)</p>
                <div class="radio-row">
                  <label><input type="radio" checked> Continue Current Goal</label>
                  <label><input type="radio"> Change Goal</label>
                </div>
                <div class="chip">8h 30m</div>
              </div>
              <div class="card-actions">
                <a class="btn-primary js-confirm-save" href="#">Confirm and Save</a>
              </div>
            </div>
          </div>

          <div class="dash-card">
            <div class="card-head">
              <h3>December Progress</h3>
            </div>
            <div class="card-body progress-card">
              <div class="progress-ring">
                <div class="ring">26 / 31</div>
                <p class="muted">Nights</p>
              </div>
              <div class="progress-meta">
                <div class="meta-row"><span>Goal Met This Month</span><strong>72%</strong></div>
                <div class="meta-row"><span>Monthly Average</span><strong>7h 35m</strong> <small>(needs
                    improvement)</small></div>
                <div class="meta-row"><span>Projected Success</span><strong>~70%</strong></div>
                <p class="note">Keep pushing for that 8-hour streak!</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <%- include('../components/footer') %>

    <script src="/js/dashboard.js"></script>